@include(top.htm)

<div id="headline">Item Overview</div>

<div class="buttonbar">
	<div id="show-kind-btn-0" onclick="showLostAndFound();" class="oneofthree">Show all items</div>
	<div id="show-kind-btn-1" onclick="showLostOnly();" class="oneofthree">Only show lost items</div>
	<div id="show-kind-btn-2" onclick="showFoundOnly();" class="oneofthree">Only show found items</div>
</div>

<div id="div-show-kind"></div>

<div class="buttonbar">
	<div id="show-cat-btn-all" onclick="showAllCats();" class="oneofthree">Show all categories</div>
	<div id="show-cat-btn-sel" onclick="showSelectedCat();" class="twoofthree">Only show: <select id="show-cat-select" onchange="showSelectedCat();">@include(categoryOptions.htm)</select></div>
</div>

<div id="div-show-cats"></div>

<div class="buttonbar">
	<div id="show-imgsize-btn-0" onclick="setAndShowImageSize(0);" class="oneofthree">Show text + large images</div>
	<div id="show-imgsize-btn-1" onclick="setAndShowImageSize(1);" class="oneofthree">Show text + small images</div>
	<div id="show-imgsize-btn-2" onclick="setAndShowImageSize(2);" class="oneofthree">Show small images only</div>
</div>

<div id="div-show-imgsize"></div>

<!-- TODO :: add plain text search! -->

<div class="divider"></div>

<div id="contentcontainer">Getting the list of all items from the server...</div>

<script>

	@include(categoryFunction.js)

	function toHtml(str) {
		return str.replace(/&/g, "&amp;")
				  .replace(/</g, "&lt;")
				  .replace(/>/g, "&gt;")
				  .replace(/\n/g, "<br>")
				  .replace(/"/g, "&quot;")
				  .replace(/'/g, "&"+"#039;");
	}

	var showKind = 0;
	var showImageSize = 0;
	var showCat = "*";

	function reShow() {

		// update based on the image size (text+large, text+small, small)
		document.getElementById("show-imgsize-btn-0").className = "oneofthree";
		document.getElementById("show-imgsize-btn-1").className = "oneofthree";
		document.getElementById("show-imgsize-btn-2").className = "oneofthree";
		document.getElementById("show-imgsize-btn-" + showImageSize).className = "oneofthree active";

		switch (showImageSize) {
			case 0:
				document.getElementById("div-show-imgsize").innerHTML = "Currently showing text + large images.";
				break;
			case 1:
				document.getElementById("div-show-imgsize").innerHTML = "Currently showing text + small images.";
				break;
			case 2:
				document.getElementById("div-show-imgsize").innerHTML = "Currently showing small images only.";
				break;
		}

		// update based on the kind (all, lost, found)
		document.getElementById("show-kind-btn-0").className = "oneofthree";
		document.getElementById("show-kind-btn-1").className = "oneofthree";
		document.getElementById("show-kind-btn-2").className = "oneofthree";
		document.getElementById("show-kind-btn-" + showKind).className = "oneofthree active";

		var lostItems = lostAndFoundData.lostItems;
		var foundItems = lostAndFoundData.foundItems;

		switch (showKind) {
			case 0:
				document.getElementById("div-show-kind").innerHTML = "Currently showing all items.";
				break;
			case 1:
				document.getElementById("div-show-kind").innerHTML = "Currently showing lost items only.";
				foundItems = [];
				break;
			case 2:
				document.getElementById("div-show-kind").innerHTML = "Currently showing found items only.";
				lostItems = [];
				break;
		}

		// update based on the category
		if (showCat == "*") {
			document.getElementById("show-cat-btn-all").className = "oneofthree active";
			document.getElementById("show-cat-btn-sel").className = "twoofthree";
			document.getElementById("div-show-cats").innerHTML = "Currently showing all categories.";
		} else {
			document.getElementById("show-cat-btn-all").className = "oneofthree";
			document.getElementById("show-cat-btn-sel").className = "twoofthree active";
			document.getElementById("div-show-cats").innerHTML = "Currently showing " + toCat(showCat) + ".";
		}

		// actually show the results
		var out = "";

		if (showImageSize < 2) {
			for (var i = 0; i < lostItems.length; i++) {
				var item = lostItems[i];
				if ((showCat == "*") || (item.cat == showCat) || ((item.cat == null) && (showCat == "others"))) {
					out += "<div id='item_" + item.id + "'>";
						out += "<h3>Item #" + toHtml(item.id) + " (Lost)</h3>";
						out += "<div>What: " + toHtml(item.what) + "</div>";
						out += "<div>Category: " + toCat(item.cat) + "</div>";
						out += "<div>When: " + toHtml(item.when) + "</div>";
						out += "<div>Where: " + toHtml(item.where) + "</div>";
						out += "<div>Who: " + toHtml(item.who) + "</div>";
						out += "<div>On-site Contact: " + toHtml(item.contactonsite) + "</div>";
						out += "<div>Off-site Contact: " + toHtml(item.contactoffsite) + "</div>";
					out += "</div>";
				}
			}
		}

		for (var i = 0; i < foundItems.length; i++) {
			var item = foundItems[i];
			if ((showCat == "*") || (item.cat == showCat) || ((item.cat == null) && (showCat == "others"))) {
				out += "<div id='item_" + item.id + "'>";
					if (showImageSize < 2) {
						out += "<h3>Item #" + toHtml(item.id) + " (Found)</h3>";
						out += "<div>What: " + toHtml(item.what) + "</div>";
						out += "<div>Category: " + toCat(item.cat) + "</div>";
					}
					if (item.picture) {
						if (showImageSize < 1) {
							out += "<img src=\"/" + item.picture + "\" />";
						} else {
							out += "<img src=\"/" + item.picture + "\" class=\"smallimg\" />";
						}
					}
					if (showImageSize < 2) {
						out += "<div>When: " + toHtml(item.when) + "</div>";
						out += "<div>Where: " + toHtml(item.where) + "</div>";
						out += "<div>Who: " + toHtml(item.who) + "</div>";
					}
				out += "</div>";
			}
		}

		document.getElementById("contentcontainer").innerHTML = out;
	}

	function showLostAndFound() {
		showKind = 0;
		reShow();
	}

	function showLostOnly() {
		showKind = 1;
		reShow();
	}

	function showFoundOnly() {
		showKind = 2;
		reShow();
	}

	function setAndShowImageSize(newSize) {
		showImageSize = newSize;
		reShow();
	}

	function showAllCats() {
		showCat = "*";
		reShow();
	}

	function showSelectedCat() {
		showCat = document.getElementById("show-cat-select").value;
		reShow();
	}

	var request = new XMLHttpRequest();
	request.open("POST", "/items", false);
	request.setRequestHeader("Content-Type", "application/json");

	// TODO :: add different categories of things (and show overviews over just items of that category)
	request.onreadystatechange = function() {
		if (request.readyState == 4 && request.status == 200) {

			window.lostAndFoundData = JSON.parse(request.responseText);

			reShow();
		}
	}

	request.send("{\"id\": \"*\"}");

</script>

@include(bottom.htm)
