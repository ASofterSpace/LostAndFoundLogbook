@include(top.htm)

<div id="headline">Item Overview</div>

<div id="contentcontainer">Getting the list of all items from the server...</div>

<script>

	@include(categoryFunction.js)

	function toHtml(str) {
		return str.replace(/&/g, "&amp;")
				  .replace(/</g, "&lt;")
				  .replace(/>/g, "&gt;")
				  .replace(/\n/g, "<br>")
				  .replace(/"/g, "&quot;")
				  .replace(/'/g, "&"+"#039;");
	}

	var request = new XMLHttpRequest();
	request.open("POST", "/items", false);
	request.setRequestHeader("Content-Type", "application/json");

	// TODO :: add different categories of things (and show overviews over just items of that category)
	request.onreadystatechange = function() {
		if (request.readyState == 4 && request.status == 200) {

			var data = JSON.parse(request.responseText);
			var lostItems = data.lostItems;
			var foundItems = data.foundItems;
			var out = "";

			for (var i = 0; i < lostItems.length; i++) {
				var item = lostItems[i];
				out += "<div id='item_" + item.id + "'>";
					out += "<h3>Item #" + toHtml(item.id) + " (Lost)</h3>";
					out += "<div>What: " + toHtml(item.what) + "</div>";
					out += "<div>Category: " + toCat(item.cat) + "</div>";
					out += "<div>When: " + toHtml(item.when) + "</div>";
					out += "<div>Where: " + toHtml(item.where) + "</div>";
					out += "<div>Who: " + toHtml(item.who) + "</div>";
					out += "<div>On-site Contact: " + toHtml(item.contactonsite) + "</div>";
					out += "<div>Off-site Contact: " + toHtml(item.contactoffsite) + "</div>";
				out += "</div>";
			}

			for (var i = 0; i < foundItems.length; i++) {
				var item = foundItems[i];
				out += "<div id='item_" + item.id + "'>";
					out += "<h3>Item #" + toHtml(item.id) + " (Found)</h3>";
					out += "<div>What: " + toHtml(item.what) + "</div>";
					out += "<div>Category: " + toCat(item.cat) + "</div>";
					if (item.picture) {
						out += "<img src=\"/" + item.picture + "\" />";
					}
					out += "<div>When: " + toHtml(item.when) + "</div>";
					out += "<div>Where: " + toHtml(item.where) + "</div>";
					out += "<div>Who: " + toHtml(item.who) + "</div>";
				out += "</div>";
			}

			document.getElementById("contentcontainer").innerHTML = out;
		}
	}

	request.send("{\"id\": \"*\"}");

</script>

@include(bottom.htm)
